@model IEnumerable<ClassAnalytics.Models.SurveyChartModel>

@{
    ViewBag.Title = "Survey Barchart";
    List<List<Object>> answers = new List<List<Object>>();
    List<string> questions = new List<string>();
}
@{ 
    foreach(var item in Model)
    {
        questions.Add(item.question);
        answers.Add(new List<object> { item.question_id, item.answer_count, item.response_count });
    }
}

<h2>Survey Charts</h2>

@using (Html.BeginForm())
{
    <div class="row" style="margin-top:-45px;padding-left:225px;padding-bottom:10px;">
        @*<div class="col-xs-4" style="width:200px;">
            @Html.DropDownList("class_id", null, "Select a Class", htmlAttributes: new { @class = "form-control" })
        </div>*@
        <div class="col-xs-4" style="width:200px;margin-left:-15px;">
            @Html.DropDownList("survey_id", null, "Select a Survey", htmlAttributes: new { @class = "form-control" })
        </div>
        <div class="col-xs-2" style="width:150px;margin-left:-20px;">
            <input type="submit" value="Search" class="btn btn-default" />
        </div>
    </div>
}


<head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['bar']});
      google.charts.setOnLoadCallback(drawStuff);

      function drawStuff() {
          var data = new google.visualization.DataTable();
          var answers = @Html.Raw(Json.Encode(answers));
          var answer_array = [];
          for(i=0;i<answers.length;i++){
              answer_array[answer_array.length] = [answers[i][0],answers[i][1],answers[i][2]];
          }
          console.log(answers);
          console.log(answer_array);
          data.addColumn('number', 'Question #');
          data.addColumn('number', 'True Responses');
          for(i = 0; i < answer_array.length; i++)
              data.addRow([answer_array[i][0], answer_array[i][1]]);
          

          var options = {
              title: 'Survey Responses',
              width: 900,
              legend: { position: 'none' },
              chart: { subtitle: 'popularity by percentage' },
              axes: {
                  x: {
                      0: { side: 'bottom', label: 'Questions'}
                  },
                  y: {
                      all: {
                          range: {
                              max: answers[1][2],
                              min: 0
                          }
                      }
                  }
          },
          bar: { groupWidth: "75%" }
        };

        var chart = new google.charts.Bar(document.getElementById('top_x_div'));
        // Convert the Classic options to Material options.
        chart.draw(data, google.charts.Bar.convertOptions(options));
      };
    </script>
</head>
<body>
    <div id="top_x_div" style="width: 900px; height: 500px;"></div>
</body>
